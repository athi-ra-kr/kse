{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Children‚Äôs Day ‚Äî Banners</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root{ --bg:#f7f8fc; --surface:#fff; --text:#0f172a; --muted:#64748b; --border:#e5e7eb;
           --brand1:#6366f1; --brand2:#a855f7; --shadow:0 10px 26px rgba(15,23,42,.06); }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
         color:var(--text); background:var(--bg); display:flex; min-height:100vh;}

    .sidebar{
      width:240px;background:var(--surface);border-right:1px solid var(--border);
      display:flex;flex-direction:column;gap:12px;padding:20px;position:fixed;inset:0 auto 0 0;
      box-shadow:2px 0 8px rgba(0,0,0,.03);
    }
    .brand{display:flex;align-items:center;gap:10px;margin-bottom:6px}
    .brand .logo{font-size:22px}
    .brand .title{font-weight:800;background:linear-gradient(90deg,var(--brand1),var(--brand2));
      -webkit-background-clip:text;background-clip:text;color:transparent}
    .nav h5{font-size:12px;color:#94a3b8;letter-spacing:.08em;text-transform:uppercase;margin:10px 0 6px}
    .nav a{display:flex;align-items:center;gap:10px;text-decoration:none;color:#374151;
      padding:10px 12px;border-radius:10px;transition:.2s}
    .nav a:hover,.nav a.active{background:#eef2ff;color:#4f46e5}
    .logout{margin-top:auto;text-align:center;text-decoration:none;padding:10px 12px;border-radius:10px;
      background:#fff1f2;color:#b91c1c;border:1px solid #fecaca;transition:filter .2s}
    .logout:hover{filter:brightness(1.02)}

    .main{flex:1;margin-left:240px;padding:20px}
    @media (max-width:900px){ .sidebar{display:none} .main{margin-left:0} }

    .topbar{
      background:var(--surface);border:1px solid var(--border);border-radius:12px;box-shadow:0 2px 8px rgba(15,23,42,.05);
      padding:12px 14px;display:flex;justify-content:space-between;align-items:center;gap:12px;position:sticky;top:12px;z-index:10;
      flex-wrap:wrap;
    }
    .btn{display:inline-flex;align-items:center;gap:8px;border:none;cursor:pointer;text-decoration:none;
      padding:9px 12px;border-radius:10px;font-weight:700;font-size:14px;transition:filter .2s}
    .btn.ghost{background:#fff;color:#111827;border:1px solid var(--border)}
    .btn:hover{filter:brightness(1.05)}
    input[type="search"], input[type="number"]{padding:10px 12px;border:1px solid var(--border);border-radius:10px}

    .container{max-width:1200px;margin:16px auto}
    .msg{padding:10px 12px;border-radius:12px;border:1px solid var(--border);margin-bottom:12px}
    .msg.success{background:#ecfdf5;color:#065f46;border-color:#a7f3d0}
    .msg.error{background:#fef2f2;color:#991b1b;border-color:#fecaca}

    .card{background:var(--surface);border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow)}
    .card-header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--border)}
    .table-wrap{width:100%;overflow:auto;border-radius:0 0 14px 14px;max-height:75vh}
    table{width:100%;border-collapse:collapse;font-size:14px;min-width:900px}
    th,td{padding:12px 10px;border-bottom:1px solid #eef2f7;text-align:left;vertical-align:middle}
    thead th{background:#f9fafb;color:#374151;position:sticky;top:0;z-index:5;border-bottom:2px solid #e5e7eb}
    .thumb{width:120px;height:80px;border-radius:8px;border:1px solid var(--border);object-fit:cover;background:#f3f4f6}

    .icon-btn{display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:10px;
      border:1px solid var(--border);background:#fff;cursor:pointer;margin-right:6px}
    .icon-btn:hover{background:#f8fafc}

    .modal{display:none;position:fixed;inset:0;z-index:1000;background:rgba(0,0,0,.32);align-items:center;justify-content:center;padding:18px}
    .modal.open{display:flex}
    .modal-card{width:min(720px, calc(100vw - 32px));background:var(--surface);border:1px solid var(--border);border-radius:16px;box-shadow:0 20px 60px rgba(2,6,23,.18);overflow:hidden}
    .modal-head{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid var(--border);background:#fff}
    .modal-body{padding:14px}
    .modal-actions{display:flex;gap:10px;justify-content:flex-end;padding:12px 14px;border-top:1px solid var(--border);background:#fff}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:680px){ .grid{grid-template-columns:1fr} }
    label{font-size:.9rem;color:#111827;display:block;margin-bottom:6px}
    input[type="text"], input[type="number"], input[type="file"]{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px}
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="brand">
      <a href="#" class="logo">
  <img src="https://www.kselimited.com/images/kselogo2.png" alt="KSE Logo" width="150" height="44">
</a>
    </div>
    <nav class="nav">

      <a href="{% url 'eventapp:dashboard' %}">Applications</a>
      <a href="{% url 'eventapp:school_list' %}">Schools</a>
      <a href="{% url 'eventapp:program_list' %}">Programmes</a>
      <a href="{% url 'eventapp:banner_list' %}" class="active">Banners</a>
         <a href="{% url 'eventapp:winners' %}" class="active">Winners</a>
    </nav>
    <a class="logout" href="{% url 'eventapp:logout' %}">Logout</a>
  </aside>

  <main class="main">
    <div class="topbar">
      <div><strong>üñºÔ∏è Banners</strong> <span style="color:#64748b;margin-left:8px">Manage homepage slider</span></div>
      <div>
        <form method="get" action="">
          <input type="search" name="q" placeholder="Search title..." value="{{ q|default:'' }}">
          <button class="btn ghost" type="submit">Search</button>
          <a class="btn ghost" href="{% url 'eventapp:banner_list' %}">Reset</a>
          <button class="btn ghost" type="button" onclick="openAdd()">+ Add Banner</button>
        </form>
      </div>
    </div>

    <div class="container">
      {% if messages %}
        {% for m in messages %}
          <div class="msg {{ m.tags }}">{{ m|safe }}</div>
        {% endfor %}
      {% endif %}

      <div class="card">
        <div class="card-header">
          <div class="muted">All Banners</div>
          <button class="btn ghost" type="button" onclick="openAdd()">+ Add</button>
        </div>

        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th style="width:60px">#</th>
                <th style="width:140px">Preview</th>
                <th>Title</th>
                <th style="width:100px">Order</th>
                <th style="width:120px">Height(px)</th>
                <th style="width:110px">Active</th>
                <th style="width:240px">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for b in banners %}
              <tr>
                <td>{{ forloop.counter }}</td>
                <td>
                  {% if b.image %}
                    <img class="thumb" src="{{ b.image.url }}" alt="{{ b.title }}">
                  {% else %}
                    <div class="thumb" style="display:flex;align-items:center;justify-content:center;color:#9ca3af;font-size:12px">No image</div>
                  {% endif %}
                </td>
                <td>{{ b.title }}</td>
                <td>{{ b.order }}</td>
                <td>{{ b.height_px }}</td>
                <td>{{ b.is_active|yesno:"Yes,No" }}</td>
                <td>
                  <!-- Edit opens a modal with inline form -->
                  <button class="icon-btn" type="button" onclick="openEdit({{ b.id }}, '{{ b.title|escapejs }}', {{ b.order }}, {{ b.height_px }}, {{ b.is_active|yesno:'true,false' }})" title="Edit">‚úèÔ∏è</button>

                  <form method="post" action="{% url 'eventapp:banner_delete' b.pk %}" style="display:inline" onsubmit="return confirm('Delete {{ b.title }}?')">
                    {% csrf_token %}
                    <button class="icon-btn" type="submit" title="Delete">üóëÔ∏è</button>
                  </form>
                </td>
              </tr>
              {% empty %}
              <tr><td colspan="7" style="color:#64748b">No banners yet. Click ‚Äú+ Add‚Äù.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>

  <!-- Add Modal -->
  <div class="modal" id="addModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="addTitle">
      <div class="modal-head">
        <h3 id="addTitle">Ôºã Add Banner</h3>
        <button class="btn ghost" type="button" onclick="closeAdd()">Close</button>
      </div>
      <form method="post" action="{% url 'eventapp:banner_create' %}" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="modal-body">
          <div class="grid">
            <div>
              <label>Title</label>
              <input type="text" name="title" required>
            </div>
            <div>
              <label>Order</label>
              <input type="number" name="order" value="0" min="0">
            </div>
            <div>
              <label>Height (px)</label>
              <input type="number" name="height_px" value="480" min="240" step="10">
            </div>
            <div>
              <label>Image</label>
              <input type="file" name="image" accept="image/*">
            </div>
            <div style="grid-column:1 / -1">
              <label><input type="checkbox" name="is_active" checked> Active</label>
            </div>
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn ghost" type="button" onclick="closeAdd()">Cancel</button>
          <button class="btn ghost" type="submit">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Edit Modal -->
  <div class="modal" id="editModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="editTitle">
      <div class="modal-head">
        <h3 id="editTitle">‚úèÔ∏è Edit Banner</h3>
        <button class="btn ghost" type="button" onclick="closeEdit()">Close</button>
      </div>
      <form method="post" id="editForm" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="modal-body">
          <div class="grid">
            <div>
              <label>Title</label>
              <input type="text" name="title" id="edit_title" required>
            </div>
            <div>
              <label>Order</label>
              <input type="number" name="order" id="edit_order" min="0">
            </div>
            <div>
              <label>Height (px)</label>
              <input type="number" name="height_px" id="edit_height" min="240" step="10">
            </div>
            <div>
              <label>Replace Image</label>
              <input type="file" name="image" accept="image/*">
            </div>
            <div style="grid-column:1 / -1">
              <label><input type="checkbox" name="is_active" id="edit_active"> Active</label>
            </div>
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn ghost" type="button" onclick="closeEdit()">Cancel</button>
          <button class="btn ghost" type="submit">Update</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Add modal
    const addModal = document.getElementById('addModal');
    function openAdd(){ addModal.classList.add('open'); }
    function closeAdd(){ addModal.classList.remove('open'); }
    addModal.addEventListener('click', e => { if(e.target === addModal) closeAdd(); });
    document.addEventListener('keydown', e => { if(e.key==='Escape' && addModal.classList.contains('open')) closeAdd(); });

    // Edit modal
    const editModal = document.getElementById('editModal');
    const editForm  = document.getElementById('editForm');
    function openEdit(id, title, order, height_px, is_active){
      document.getElementById('edit_title').value = title;
      document.getElementById('edit_order').value = order;
      document.getElementById('edit_height').value = height_px;
      document.getElementById('edit_active').checked = !!is_active;
      editForm.action = `{% url 'eventapp:banner_update' 0 %}`.replace('/0/', `/${id}/`);
      editModal.classList.add('open');
    }
    function closeEdit(){ editModal.classList.remove('open'); }
    editModal.addEventListener('click', e => { if(e.target === editModal) closeEdit(); });
    document.addEventListener('keydown', e => { if(e.key==='Escape' && editModal.classList.contains('open')) closeEdit(); });
  </script>
</body>
</html>
